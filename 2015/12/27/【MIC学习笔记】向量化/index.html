<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">






<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="MIC,学习笔记,">





  <link rel="alternate" href="/atom.xml" title="jk's Blog" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="前言向量化简单的说就是使用SIMD指令, 来实现使用一条指令同时处理多个数据, MIC中具有32个长度为512位的向量处理单元, 每个向量处理单元可以处理16个32位或者8个64位的数据. 这里主要记录一下MIC向量化的使用方式以及一些向量指令的作用.  数据类型MIC中使用下面的数据类型作为执行向量函数的操作数1__m512, __m512i  __m512d 下面是它们的各自的作用:  __m">
<meta name="keywords" content="MIC,学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="【MIC学习笔记】向量化">
<meta property="og:url" content="http://blog.zhangjikai.com/2015/12/27/【MIC学习笔记】向量化/index.html">
<meta property="og:site_name" content="jk&#39;s Blog">
<meta property="og:description" content="前言向量化简单的说就是使用SIMD指令, 来实现使用一条指令同时处理多个数据, MIC中具有32个长度为512位的向量处理单元, 每个向量处理单元可以处理16个32位或者8个64位的数据. 这里主要记录一下MIC向量化的使用方式以及一些向量指令的作用.  数据类型MIC中使用下面的数据类型作为执行向量函数的操作数1__m512, __m512i  __m512d 下面是它们的各自的作用:  __m">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-09-08T06:53:07.629Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【MIC学习笔记】向量化">
<meta name="twitter:description" content="前言向量化简单的说就是使用SIMD指令, 来实现使用一条指令同时处理多个数据, MIC中具有32个长度为512位的向量处理单元, 每个向量处理单元可以处理16个32位或者8个64位的数据. 这里主要记录一下MIC向量化的使用方式以及一些向量指令的作用.  数据类型MIC中使用下面的数据类型作为执行向量函数的操作数1__m512, __m512i  __m512d 下面是它们的各自的作用:  __m">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.zhangjikai.com/2015/12/27/【MIC学习笔记】向量化/">





  <title> 【MIC学习笔记】向量化 | jk's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?af860476cab57661f1dbb67fe9e0620f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jk's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">No Start No End</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.zhangjikai.com/2015/12/27/【MIC学习笔记】向量化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Jikai">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jk's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                【MIC学习笔记】向量化
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-12-27T16:58:31+08:00">
                2015-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MIC/" itemprop="url" rel="index">
                    <span itemprop="name">MIC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/12/27/【MIC学习笔记】向量化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/12/27/【MIC学习笔记】向量化/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                <span title="字数统计">
                  3,606
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                <span title="阅读时长">
                  19
                </span>
              

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>向量化简单的说就是使用SIMD指令, 来实现使用一条指令同时处理多个数据, MIC中具有32个长度为512位的向量处理单元, 每个向量处理单元可以处理16个32位或者8个64位的数据. 这里主要记录一下MIC向量化的使用方式以及一些向量指令的作用. </p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>MIC中使用下面的数据类型作为执行向量函数的操作数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__m512, __m512i  __m512d</span><br></pre></td></tr></table></figure></p>
<p>下面是它们的各自的作用:</p>
<ul>
<li><code>__m512</code> - 处理单精度向量(float32 vector)</li>
<li><code>__m512d</code> - 处理双精度向量(float64 vector)</li>
<li><code>__m512i</code> - 处理整形向量, 包括32位和64位整形(int32/int64)<a id="more"></a>
上面的数据类型直接映射到向量寄存器上(vector registers), 除此之外还有一种数据类型__mmask16 - is an unsigned short type associated with the mask register values.<br>我们可以使用 <code>Load Intrinsics</code>(为向量赋值) 和 <code>Store Intrinsics</code> (保存向量的值) 实现向量的存取. 下面是一个示例</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_load_store</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用int32_t和int64_t 需要引入stdint.h</span></span><br><span class="line">    <span class="keyword">int32_t</span> *arr_int32;</span><br><span class="line">    <span class="keyword">int64_t</span> *arr_int64;</span><br><span class="line">    <span class="keyword">int</span> i, n = <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 需要使用_mm_malloc分配内存, 并且以64位对齐, 否则可能出现错误</span></span><br><span class="line">    arr_int32 = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">int32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_int64 = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">int64_t</span>) * n, <span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        arr_int32[i] = i;</span><br><span class="line">        arr_int64[i] = i + n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> offload target(mic) inout(arr_int32:length(n)) inout(arr_int64:length(n))</span></span><br><span class="line">    &#123;</span><br><span class="line">        __m512i m_32, m_64;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将arr_int32 中0-15个元素加载到 m_32 中</span></span><br><span class="line">        m_32 = _mm512_load_epi32(arr_int32);</span><br><span class="line">        <span class="comment">// 将arr_int32 中16-31个元素加载到 m_32 中</span></span><br><span class="line">        m_32 = _mm512_load_epi32(arr_int32 + <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将arr_int64中0-7个元素加载到 m_64 中</span></span><br><span class="line">        m_64 = _mm512_load_epi64(arr_int64);</span><br><span class="line">        <span class="comment">// 将arr_int64中8-15个元素加载到 m_64 中</span></span><br><span class="line">        m_64 = _mm512_load_epi64(arr_int64 + <span class="number">8</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 将m_32 中的值保存到arr_int32 的0-15个元素中</span></span><br><span class="line">        _mm512_store_epi32(arr_int32, m_32);</span><br><span class="line">        <span class="comment">// 将m_64 中的值保存到arr_int32 的16-31个元素中</span></span><br><span class="line">        _mm512_store_epi32(arr_int32 + <span class="number">16</span>, m_32);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将m_64 中的值保存到arr_int64的0-7个元素</span></span><br><span class="line">        _mm512_store_epi64(arr_int64, m_64);</span><br><span class="line">        <span class="comment">// 将m_64 中的值保存到arr_int64的8-15个元素中</span></span><br><span class="line">        _mm512_store_epi64(arr_int64 + <span class="number">8</span>, m_64);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用_mm_malloc分配的内存需要_mm_free来释放</span></span><br><span class="line">    _mm_free(arr_int32);</span><br><span class="line">    _mm_free(arr_int64);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="向量化函数-Intrinsics"><a href="#向量化函数-Intrinsics" class="headerlink" title="向量化函数(Intrinsics)"></a>向量化函数(Intrinsics)</h2><p>这里主要记录一些编译器提供的向量化函数, 完整的函数集可以在<a href="https://software.intel.com/en-us/node/523386" target="_blank" rel="noopener">这里</a>或者<a href="http://scc.ustc.edu.cn/zlsc/tc4600/intel/2015.1.133/compiler_c/" target="_blank" rel="noopener">这里</a>查询</p>
<h3 id="算术运算"><a href="#算术运算" class="headerlink" title="算术运算"></a>算术运算</h3><p>MIC中提供了加,减, 乘 三种算术运算函数, 这里以32位整型的加法为例:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;immintrin.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mic_add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> *arr_a, *arr_b, *arr_c;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    arr_a = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_b = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_c = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        arr_a[i] = i;</span><br><span class="line">        arr_b[i] = n + i; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> offload target(mic) in(arr_a:length(n)) in(arr_b:length(n)) out(arr_c:length(n))</span></span><br><span class="line">    &#123;</span><br><span class="line">        __m512i m_a, m_b, m_c;</span><br><span class="line">        m_a = _mm512_load_epi32(arr_a);</span><br><span class="line">        m_b = _mm512_load_epi32(arr_b);</span><br><span class="line">        m_c = _mm512_add_epi32(m_a, m_b);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 减法</span></span><br><span class="line">        <span class="comment">//m_c = _mm512_sub_epi32(m_a, m_b);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 乘法 _mm512_mullo_epi32 保留乘法结果的低32位, _mm512_mulhi_epi32保存结果的高32位</span></span><br><span class="line">        <span class="comment">// m_c = _mm512_mullo_epi32(m_a, m_b);</span></span><br><span class="line">        _mm512_store_epi32(arr_c, m_c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"arr_a[%2d] is: %2d \t  arr_b[%2d] is: %2d \t  arr_c[%2d] is : %2d\n"</span>, i, arr_a[i], i, arr_b[i], i, arr_c[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    _mm_free(arr_a);</span><br><span class="line">    _mm_free(arr_b);</span><br><span class="line">    _mm_free(arr_c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mic_add();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>输出结果为:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">arr_a[ 0] is:  0 	  arr_b[ 0] is: 16 	  arr_c[ 0] is : 16</span><br><span class="line">arr_a[ 1] is:  1 	  arr_b[ 1] is: 17 	  arr_c[ 1] is : 18</span><br><span class="line">arr_a[ 2] is:  2 	  arr_b[ 2] is: 18 	  arr_c[ 2] is : 20</span><br><span class="line">arr_a[ 3] is:  3 	  arr_b[ 3] is: 19 	  arr_c[ 3] is : 22</span><br><span class="line">arr_a[ 4] is:  4 	  arr_b[ 4] is: 20 	  arr_c[ 4] is : 24</span><br><span class="line">arr_a[ 5] is:  5 	  arr_b[ 5] is: 21 	  arr_c[ 5] is : 26</span><br><span class="line">arr_a[ 6] is:  6 	  arr_b[ 6] is: 22 	  arr_c[ 6] is : 28</span><br><span class="line">arr_a[ 7] is:  7 	  arr_b[ 7] is: 23 	  arr_c[ 7] is : 30</span><br><span class="line">arr_a[ 8] is:  8 	  arr_b[ 8] is: 24 	  arr_c[ 8] is : 32</span><br><span class="line">arr_a[ 9] is:  9 	  arr_b[ 9] is: 25 	  arr_c[ 9] is : 34</span><br><span class="line">arr_a[10] is: 10 	  arr_b[10] is: 26 	  arr_c[10] is : 36</span><br><span class="line">arr_a[11] is: 11 	  arr_b[11] is: 27 	  arr_c[11] is : 38</span><br><span class="line">arr_a[12] is: 12 	  arr_b[12] is: 28 	  arr_c[12] is : 40</span><br><span class="line">arr_a[13] is: 13 	  arr_b[13] is: 29 	  arr_c[13] is : 42</span><br><span class="line">arr_a[14] is: 14 	  arr_b[14] is: 30 	  arr_c[14] is : 44</span><br><span class="line">arr_a[15] is: 15 	  arr_b[15] is: 31 	  arr_c[15] is : 46</span><br></pre></td></tr></table></figure></p>
<h3 id="With-Mask"><a href="#With-Mask" class="headerlink" title="With Mask"></a>With Mask</h3><p>MIC提供的向量函数一般有两种形式<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Without Mask</span></span><br><span class="line"><span class="keyword">extern</span> _m512i __cdecl _mm512_add_epi32(_m512i v2, _m512i v3);</span><br><span class="line"></span><br><span class="line"><span class="comment">// With Mask</span></span><br><span class="line"><span class="keyword">extern</span> _m512i __cdecl _mm512_mask_add_epi32(_m512i v1_old, __mmask16 k1, _m512i v2, _m512i v3);</span><br></pre></td></tr></table></figure></p>
<p>一种是带Mask的, 一种是不带Mask的. 带Mask的多了两个参数: <code>v1_old</code>和<code>k1</code>, 其中<code>k1</code>是<code>__mmask16</code>类型的数据, 在上面我们知道<code>__mmask</code>类型就是<code>unsigned short</code>类型, 长度为16位. 关于带mask函数的解释: 将<code>v1</code>的16位分别对应到<code>_m512i</code>的16个整型上, 如果<code>k1</code>某个位是1, 则将v2和v3中与该位对应的整型相加, 作为结果值, 如果<code>k1</code>某个位为0, 就使用<code>v1_old</code>向量中对应位的整型作为结果值. 例如如果<code>k1</code>的第一位为1, 那么就将<code>v2</code>的第一个整数和<code>v3</code>的第一个整数相加, 作为结果向量的第一个整型的值. 如果<code>k1</code>的第一位是0, 就将<code>v1_old</code>向量中的第一个整型的值作为结果向量中第一个整型的值. 好吧, 还是看个例子吧.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mic_mask_add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> *arr_a, *arr_b, *arr_c, *arr_old;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    arr_a = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_b = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_c = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_old = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        arr_a[i] = i;</span><br><span class="line">        arr_b[i] = n + i; </span><br><span class="line">        arr_old[i] = <span class="number">10000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> offload target(mic) in(arr_a:length(n)) in(arr_b:length(n)) in(arr_old:length(n)) out(arr_c:length(n))</span></span><br><span class="line">    &#123;</span><br><span class="line">        __m512i m_a, m_b, m_c, m_old;</span><br><span class="line">        <span class="comment">// 11换成二进制就是0000000000001011</span></span><br><span class="line">        __mmask16 k1 = <span class="number">11</span>;</span><br><span class="line">        m_a = _mm512_load_epi32(arr_a);</span><br><span class="line">        m_b = _mm512_load_epi32(arr_b);</span><br><span class="line">        m_old = _mm512_load_epi32(arr_old);</span><br><span class="line">        <span class="comment">// 根据k1的值只有1,2,4位为1 所以m_c中只有第1,2,4个元素为m_a 和m_b中1,2,4个元素的和 剩余元素使用arr_old对应元素的值</span></span><br><span class="line">        m_c = _mm512_mask_add_epi32(m_old, k1, m_a, m_b);</span><br><span class="line">        _mm512_store_epi32(arr_c, m_c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"arr_a[%2d] is: %2d \t  arr_b[%2d] is: %2d \t arr_old[%2d] is: %d \t  arr_c[%2d] is : %2d\n"</span>, i, arr_a[i], i, arr_b[i], i, arr_old[i], i, arr_c[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    _mm_free(arr_a);</span><br><span class="line">    _mm_free(arr_b);</span><br><span class="line">    _mm_free(arr_c);</span><br><span class="line">    _mm_free(arr_old);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果为:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">arr_a[ 0] is:  0 	  arr_b[ 0] is: 16 	 arr_old[ 0] is: 10000 	  arr_c[ 0] is : 16</span><br><span class="line">arr_a[ 1] is:  1 	  arr_b[ 1] is: 17 	 arr_old[ 1] is: 10000 	  arr_c[ 1] is : 18</span><br><span class="line">arr_a[ 2] is:  2 	  arr_b[ 2] is: 18 	 arr_old[ 2] is: 10000 	  arr_c[ 2] is : 10000</span><br><span class="line">arr_a[ 3] is:  3 	  arr_b[ 3] is: 19 	 arr_old[ 3] is: 10000 	  arr_c[ 3] is : 22</span><br><span class="line">arr_a[ 4] is:  4 	  arr_b[ 4] is: 20 	 arr_old[ 4] is: 10000 	  arr_c[ 4] is : 10000</span><br><span class="line">arr_a[ 5] is:  5 	  arr_b[ 5] is: 21 	 arr_old[ 5] is: 10000 	  arr_c[ 5] is : 10000</span><br><span class="line">arr_a[ 6] is:  6 	  arr_b[ 6] is: 22 	 arr_old[ 6] is: 10000 	  arr_c[ 6] is : 10000</span><br><span class="line">arr_a[ 7] is:  7 	  arr_b[ 7] is: 23 	 arr_old[ 7] is: 10000 	  arr_c[ 7] is : 10000</span><br><span class="line">arr_a[ 8] is:  8 	  arr_b[ 8] is: 24 	 arr_old[ 8] is: 10000 	  arr_c[ 8] is : 10000</span><br><span class="line">arr_a[ 9] is:  9 	  arr_b[ 9] is: 25 	 arr_old[ 9] is: 10000 	  arr_c[ 9] is : 10000</span><br><span class="line">arr_a[10] is: 10 	  arr_b[10] is: 26 	 arr_old[10] is: 10000 	  arr_c[10] is : 10000</span><br><span class="line">arr_a[11] is: 11 	  arr_b[11] is: 27 	 arr_old[11] is: 10000 	  arr_c[11] is : 10000</span><br><span class="line">arr_a[12] is: 12 	  arr_b[12] is: 28 	 arr_old[12] is: 10000 	  arr_c[12] is : 10000</span><br><span class="line">arr_a[13] is: 13 	  arr_b[13] is: 29 	 arr_old[13] is: 10000 	  arr_c[13] is : 10000</span><br><span class="line">arr_a[14] is: 14 	  arr_b[14] is: 30 	 arr_old[14] is: 10000 	  arr_c[14] is : 10000</span><br><span class="line">arr_a[15] is: 15 	  arr_b[15] is: 31 	 arr_old[15] is: 10000 	  arr_c[15] is : 10000</span><br></pre></td></tr></table></figure></p>
<h3 id="Bitwise运算"><a href="#Bitwise运算" class="headerlink" title="Bitwise运算"></a>Bitwise运算</h3><p>MIC中提供了3中Bitwise运算函数- <code>and</code> <code>or</code> <code>xor</code>,  其中取反元素可以通过与1异或来实现, 下面是<code>and</code>操作的一个例子<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mic_and</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> *arr_a, *arr_b, *arr_c;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    arr_a = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_b = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_c = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        arr_a[i] = i ;</span><br><span class="line">        arr_b[i] = n + i; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> offload target(mic) in(arr_a:length(n)) in(arr_b:length(n)) out(arr_c:length(n))</span></span><br><span class="line">    &#123;</span><br><span class="line">        __m512i m_a, m_b, m_c;</span><br><span class="line">        m_a = _mm512_load_epi32(arr_a);</span><br><span class="line">        m_b = _mm512_load_epi32(arr_b);</span><br><span class="line">        m_c = _mm512_and_epi32(m_a, m_b);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// or</span></span><br><span class="line">        <span class="comment">// m_c = _mm512_or_epi32(m_a, m_b);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// xor</span></span><br><span class="line">        <span class="comment">// m_c = _mm512_xor_epi32(m_a, m_b);</span></span><br><span class="line">        _mm512_store_epi32(arr_c, m_c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        print_binary (arr_a[i], <span class="number">8</span>);</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">" &amp; "</span>);</span><br><span class="line">        print_binary(arr_b[i], <span class="number">8</span>);</span><br><span class="line">        <span class="built_in">printf</span> (<span class="string">" = "</span>);</span><br><span class="line">        print_binary(arr_c[i], <span class="number">8</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    _mm_free(arr_a);</span><br><span class="line">    _mm_free(arr_b);</span><br><span class="line">    _mm_free(arr_c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其中<code>print_binary</code>是一个打印二进制的函数, 这里只打印了后8位<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 打印二进制</span></span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">print_binary</span><span class="params">(<span class="keyword">uint64_t</span> t, <span class="keyword">int</span> bit_len)</span> </span>&#123;</span><br><span class="line">true<span class="keyword">short</span> buffer[bit_len];</span><br><span class="line">true<span class="keyword">int</span> i;</span><br><span class="line">true<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; bit_len; i++) &#123;</span><br><span class="line">truetruebuffer[i] = <span class="number">0</span>;</span><br><span class="line">true&#125;</span><br><span class="line"></span><br><span class="line">true<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; bit_len; i++) &#123;</span><br><span class="line">truetrue<span class="keyword">if</span> (t == <span class="number">0</span>)</span><br><span class="line">truetruetrue<span class="keyword">break</span>;</span><br><span class="line">truetrue<span class="keyword">if</span> (t % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">truetruetruebuffer[i] = <span class="number">0</span>;</span><br><span class="line">truetrue&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">truetruetruebuffer[i] = <span class="number">1</span>;</span><br><span class="line">truetrue&#125;</span><br><span class="line">truetruet = t / <span class="number">2</span>;</span><br><span class="line">true&#125;</span><br><span class="line">true<span class="keyword">for</span> (i = bit_len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">truetrue<span class="built_in">printf</span>(<span class="string">"%hd"</span>, buffer[i]);</span><br><span class="line">true&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面是一个取反的示例<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mic_not</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> *arr_a, *arr_c;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    arr_a = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_c = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        arr_a[i] = i ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> offload target(mic) in(arr_a:length(n)) out(arr_c:length(n))</span></span><br><span class="line">    &#123;</span><br><span class="line">        __m512i m_a, m_b, m_c;</span><br><span class="line">        <span class="keyword">int32_t</span> all_one = <span class="number">0xffffffff</span>;</span><br><span class="line">        <span class="comment">// _mm512_set1_epi32 : 将向量中的16个整型都设为all_one</span></span><br><span class="line">        m_b = _mm512_set1_epi32(all_one);</span><br><span class="line">        m_a = _mm512_load_epi32(arr_a);</span><br><span class="line">        m_c = _mm512_xor_epi32(m_a, m_b);</span><br><span class="line">        _mm512_store_epi32(arr_c, m_c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"~ "</span>);</span><br><span class="line">        print_binary (arr_a[i], <span class="number">8</span>);</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">" = "</span>);</span><br><span class="line">        print_binary(arr_c[i], <span class="number">8</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    _mm_free(arr_a);</span><br><span class="line">    _mm_free(arr_c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面是运行结果<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~ 00000000 = 11111111</span><br><span class="line">~ 00000001 = 11111110</span><br><span class="line">~ 00000010 = 11111101</span><br><span class="line">~ 00000011 = 11111100</span><br><span class="line">~ 00000100 = 11111011</span><br><span class="line">~ 00000101 = 11111010</span><br><span class="line">~ 00000110 = 11111001</span><br><span class="line">~ 00000111 = 11111000</span><br><span class="line">~ 00001000 = 11110111</span><br><span class="line">~ 00001001 = 11110110</span><br><span class="line">~ 00001010 = 11110101</span><br><span class="line">~ 00001011 = 11110100</span><br><span class="line">~ 00001100 = 11110011</span><br><span class="line">~ 00001101 = 11110010</span><br><span class="line">~ 00001110 = 11110001</span><br><span class="line">~ 00001111 = 11110000</span><br></pre></td></tr></table></figure></p>
<h3 id="移位操作"><a href="#移位操作" class="headerlink" title="移位操作"></a>移位操作</h3><p>移位操作分为算术移位和逻辑移位, 逻辑左移和算术左移的规则是一样的, 所以两者共用同一个左移函数, 而逻辑右移和算术右移不同, 逻辑右移是一直补0, 而算术右移要看符号位, 符号位为0则补0, 符号位为1, 则补1. 同时移位操作有两种形式, 一种给定一个常数, 向量中的每个元素都移该常数位, 一种是给定一个向量, 向量中的每个元素移给定向量中对应数值的位. 好吧下面还是看例子吧.<br><strong>左移: 给定一个常数</strong><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mic_lshift</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> *arr_a, *arr_c;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    arr_a = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_c = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        arr_a[i] = i ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> offload target(mic) in(arr_a:length(n)) out(arr_c:length(n))</span></span><br><span class="line">    &#123;</span><br><span class="line">        __m512i m_a, m_c;</span><br><span class="line">        m_a = _mm512_load_epi32(arr_a);</span><br><span class="line">        <span class="comment">// 向量中的每个整型都左移一位 ,逻辑右移 _mm512_srli_epi32</span></span><br><span class="line">        m_c = _mm512_slli_epi32 (m_a, <span class="number">1</span>);</span><br><span class="line">        _mm512_store_epi32(arr_c, m_c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        print_binary (arr_a[i], <span class="number">8</span>);</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">" \t  "</span>);</span><br><span class="line">        print_binary(arr_c[i], <span class="number">8</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    _mm_free(arr_a);</span><br><span class="line">    _mm_free(arr_c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>左移:给定一个向量</strong><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mic_lshift_v</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> *arr_a, *arr_c;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    arr_a = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_c = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        arr_a[i] = i+<span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> offload target(mic) in(arr_a:length(n)) out(arr_c:length(n))</span></span><br><span class="line">    &#123;</span><br><span class="line">        __m512i m_a, m_b, m_c;</span><br><span class="line">        <span class="comment">// _mm512_set_epi32(int e15, int e14, int e13, int e12, int e11, int e10, int e9, int e8, int e7, int e6, int e5, int e4, int e3, int e2, int e1, int e0);</span></span><br><span class="line">        <span class="comment">// _mm512_set_epi32 按从高到低的顺序, 第一个参数设为向量中第16个整型的值, 最后一个参数设为第1个整型的值</span></span><br><span class="line">        m_b = _mm512_set_epi32(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line">        m_a = _mm512_load_epi32(arr_a);</span><br><span class="line">        <span class="comment">//  逻辑右移 _mm512_srlv_epi32</span></span><br><span class="line">        m_c = _mm512_sllv_epi32 (m_a, m_b);</span><br><span class="line">        _mm512_store_epi32(arr_c, m_c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        print_binary (arr_a[i], <span class="number">8</span>);</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">" \t  "</span>);</span><br><span class="line">        print_binary(arr_c[i], <span class="number">8</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    _mm_free(arr_a);</span><br><span class="line">    _mm_free(arr_c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行结果为:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">00000001 	  00010000</span><br><span class="line">00000010 	  00010000</span><br><span class="line">00000011 	  00001100</span><br><span class="line">00000100 	  00001000</span><br><span class="line">00000101 	  01010000</span><br><span class="line">00000110 	  00110000</span><br><span class="line">00000111 	  00011100</span><br><span class="line">00001000 	  00010000</span><br><span class="line">00001001 	  10010000</span><br><span class="line">00001010 	  01010000</span><br><span class="line">00001011 	  00101100</span><br><span class="line">00001100 	  00011000</span><br><span class="line">00001101 	  11010000</span><br><span class="line">00001110 	  01110000</span><br><span class="line">00001111 	  00111100</span><br><span class="line">00010000 	  00100000</span><br></pre></td></tr></table></figure></p>
<p><strong>算术右移</strong><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mic_arshift</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> *arr_a, *arr_b, *arr_c, *arr_d;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    arr_a = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_b = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_c = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_d = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint32_t</span> high_one = <span class="number">1</span> &lt;&lt; <span class="number">31</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        arr_a[i] = i+<span class="number">1</span>;</span><br><span class="line">        arr_b[i] = high_one | (i + <span class="number">1</span>); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> offload target(mic) in(arr_a:length(n)) in(arr_b:length(n)) out(arr_c:length(n)) out(arr_d:length(n))</span></span><br><span class="line">    &#123;</span><br><span class="line">        __m512i m_a,m_b, m_c, m_d;</span><br><span class="line">        m_a = _mm512_load_epi32(arr_a);</span><br><span class="line">        <span class="comment">//  算术右移, 符号为0, 补0；符号位为1, 补1</span></span><br><span class="line">        m_c = _mm512_srai_epi32 (m_a, <span class="number">2</span>);</span><br><span class="line">        _mm512_store_epi32(arr_c, m_c);</span><br><span class="line">        m_b = _mm512_load_epi32(arr_b);</span><br><span class="line">        m_d = _mm512_srai_epi32(m_b, <span class="number">2</span>);</span><br><span class="line">        _mm512_store_epi32(arr_d, m_d);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"符号位为0: \n"</span>);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        print_binary (arr_a[i],<span class="number">32</span>);</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">" \t  "</span>);</span><br><span class="line">        print_binary(arr_c[i], <span class="number">32</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"符号位为1: \n"</span>);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        print_binary (arr_b[i],<span class="number">32</span>);</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">" \t  "</span>);</span><br><span class="line">        print_binary(arr_d[i], <span class="number">32</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _mm_free(arr_a);</span><br><span class="line">    _mm_free(arr_b);</span><br><span class="line">    _mm_free(arr_c);</span><br><span class="line">    _mm_free(arr_d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行结果为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">符号位为0: </span><br><span class="line">00000000000000000000000000000001 	  00000000000000000000000000000000</span><br><span class="line">00000000000000000000000000000010 	  00000000000000000000000000000000</span><br><span class="line">00000000000000000000000000000011 	  00000000000000000000000000000000</span><br><span class="line">00000000000000000000000000000100 	  00000000000000000000000000000001</span><br><span class="line">00000000000000000000000000000101 	  00000000000000000000000000000001</span><br><span class="line">00000000000000000000000000000110 	  00000000000000000000000000000001</span><br><span class="line">00000000000000000000000000000111 	  00000000000000000000000000000001</span><br><span class="line">00000000000000000000000000001000 	  00000000000000000000000000000010</span><br><span class="line">00000000000000000000000000001001 	  00000000000000000000000000000010</span><br><span class="line">00000000000000000000000000001010 	  00000000000000000000000000000010</span><br><span class="line">00000000000000000000000000001011 	  00000000000000000000000000000010</span><br><span class="line">00000000000000000000000000001100 	  00000000000000000000000000000011</span><br><span class="line">00000000000000000000000000001101 	  00000000000000000000000000000011</span><br><span class="line">00000000000000000000000000001110 	  00000000000000000000000000000011</span><br><span class="line">00000000000000000000000000001111 	  00000000000000000000000000000011</span><br><span class="line">00000000000000000000000000010000 	  00000000000000000000000000000100</span><br><span class="line">符号位为1: </span><br><span class="line">10000000000000000000000000000001 	  11100000000000000000000000000000</span><br><span class="line">10000000000000000000000000000010 	  11100000000000000000000000000000</span><br><span class="line">10000000000000000000000000000011 	  11100000000000000000000000000000</span><br><span class="line">10000000000000000000000000000100 	  11100000000000000000000000000001</span><br><span class="line">10000000000000000000000000000101 	  11100000000000000000000000000001</span><br><span class="line">10000000000000000000000000000110 	  11100000000000000000000000000001</span><br><span class="line">10000000000000000000000000000111 	  11100000000000000000000000000001</span><br><span class="line">10000000000000000000000000001000 	  11100000000000000000000000000010</span><br><span class="line">10000000000000000000000000001001 	  11100000000000000000000000000010</span><br><span class="line">10000000000000000000000000001010 	  11100000000000000000000000000010</span><br><span class="line">10000000000000000000000000001011 	  11100000000000000000000000000010</span><br><span class="line">10000000000000000000000000001100 	  11100000000000000000000000000011</span><br><span class="line">10000000000000000000000000001101 	  11100000000000000000000000000011</span><br><span class="line">10000000000000000000000000001110 	  11100000000000000000000000000011</span><br><span class="line">10000000000000000000000000001111 	  11100000000000000000000000000011</span><br><span class="line">10000000000000000000000000010000 	  11100000000000000000000000000100</span><br></pre></td></tr></table></figure></p>
<h3 id="mm512-alignr-epi32"><a href="#mm512-alignr-epi32" class="headerlink" title="_mm512_alignr_epi32"></a>_mm512_alignr_epi32</h3><p>函数原型为:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> __m512i __cdecl _mm512_alignr_epi32(__m512i v2, __m512i v3, <span class="keyword">const</span> <span class="keyword">int</span> count);</span><br></pre></td></tr></table></figure></p>
<p>该函数的作用就是将v2和v3拼接起来, v2在前, v3在后, 然后循环左移count个元素, 然后取最右侧的16个元素, 下面看个例子<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mic_alignr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> *arr_a, *arr_b, *arr_c, *arr_d;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    arr_a = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_b = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_c = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line">    arr_d = _mm_malloc(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * n, <span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        arr_a[i] = i+<span class="number">1</span>;</span><br><span class="line">        arr_b[i] = n + i + <span class="number">1</span>; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> offload target(mic) in(arr_a:length(n)) in(arr_b:length(n)) out(arr_c:length(n)) out(arr_d:length(n))</span></span><br><span class="line">    &#123;</span><br><span class="line">        __m512i m_a,m_b, m_c, m_d;</span><br><span class="line">        m_a = _mm512_load_epi32(arr_a);</span><br><span class="line">        m_b = _mm512_load_epi32(arr_b);</span><br><span class="line">        <span class="comment">//  算术右移, 符号为0, 补0；符号位为1, 补1</span></span><br><span class="line">        m_c = _mm512_alignr_epi32 (m_a, m_b, <span class="number">3</span>);</span><br><span class="line">        _mm512_store_epi32(arr_c, m_c);</span><br><span class="line">        m_d = _mm512_alignr_epi32(m_a, m_b, <span class="number">8</span>);</span><br><span class="line">        _mm512_store_epi32(arr_d, m_d);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"arr_a: "</span>);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%2u "</span>, arr_a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">" \narr_b: "</span>);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%2u "</span>, arr_b[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"count = 3  arr_c: "</span>);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%2u "</span>, arr_c[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"count = 8  arr_c: "</span>);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%2u "</span>, arr_d[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">    _mm_free(arr_a);</span><br><span class="line">    _mm_free(arr_b);</span><br><span class="line">    _mm_free(arr_c);</span><br><span class="line">    _mm_free(arr_d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行结果为:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr_a:  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16  </span><br><span class="line">arr_b: 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 </span><br><span class="line"></span><br><span class="line">count = 3  arr_c: 20 21 22 23 24 25 26 27 28 29 30 31 32  1  2  3 </span><br><span class="line">count = 8  arr_c: 25 26 27 28 29 30 31 32  1  2  3  4  5  6  7  8</span><br></pre></td></tr></table></figure></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/MIC/" rel="tag"># MIC</a>
          
            <a href="/tags/学习笔记/" rel="tag"># 学习笔记</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/12/26/【软件】Intellij-IDEA-14-导入maven-web项目并发布到Tomcat/" rel="next" title="【软件】Intellij IDEA 导入maven web项目并部署到Tomcat">
                <i class="fa fa-chevron-left"></i> 【软件】Intellij IDEA 导入maven web项目并部署到Tomcat
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/01/25/【OpenMP学习笔记】基本使用/" rel="prev" title="【OpenMP学习笔记】基本使用">
                【OpenMP学习笔记】基本使用 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar/avatar.png" alt="Zhang Jikai">
          <p class="site-author-name" itemprop="name">Zhang Jikai</p>
           
              <p class="site-description motion-element" itemprop="description">No Start No End</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zhangjikai" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.throneclay.com/" title="Shuai's Blog" target="_blank">Shuai's Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://xukai.xyz" title="Xukai" target="_blank">Xukai</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://leiquan.website/" title="Leiquan" target="_blank">Leiquan</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据类型"><span class="nav-number">2.</span> <span class="nav-text">数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#向量化函数-Intrinsics"><span class="nav-number">3.</span> <span class="nav-text">向量化函数(Intrinsics)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#算术运算"><span class="nav-number">3.1.</span> <span class="nav-text">算术运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#With-Mask"><span class="nav-number">3.2.</span> <span class="nav-text">With Mask</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bitwise运算"><span class="nav-number">3.3.</span> <span class="nav-text">Bitwise运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移位操作"><span class="nav-number">3.4.</span> <span class="nav-text">移位操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mm512-alignr-epi32"><span class="nav-number">3.5.</span> <span class="nav-text">_mm512_alignr_epi32</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang Jikai</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://blog-aclemypgmr.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://blog.zhangjikai.com/2015/12/27/【MIC学习笔记】向量化/';
          this.page.identifier = '2015/12/27/【MIC学习笔记】向量化/';
          this.page.title = '【MIC学习笔记】向量化';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://blog-aclemypgmr.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
